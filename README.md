# web-wasm-template
A template to create a Web Assembly crate for the Web

#### Features

1. Uses `opt-level = "s"` in the `Cargo.toml` file to tell Rust compiler to optimize code for small binary sizes
2. Uses `wee_alloc` crate to change the default global allocator to `wee_alloc` for small code sizes
3. Adds a `Makefile.toml` pre-configured for use with `cargo-make` 
4. Adds a `deny.toml` file to check for compatible licenses
5. Adds a `resources` folder that contains a default `index.html` file configured to be uses by the template

#### The `deny.toml` file

This file is generated by `cargo-deny` crate and it is configured to accept liberally licensed crates that use `MIT` and `Apache-2.0` licenses with the exception of `wee_alloc` crate which uses a more permissive version of the `Mozilla Public License (MPL-2.0)`

#### The `Makefile.toml` file

This explains the various sections of this file and how to run them. `cargo-make` is an amazing task runner with many features and written in Rust.

Install the `cargo-make` crate by running

```bash
cargo install cargo-make
```

This installs a `cargo-make` binary and a `makers` binary. The `cargo-make` binary is used when running tasks from a `rust cargo` workflow while the `makers` binary can be used to run tasks from any workflow even a non-rust workflow.

The documentation for `cargo-make` can be found at [https://sagiegurari.github.io/cargo-make/](https://sagiegurari.github.io/cargo-make/)

1. `[tasks.default]` - runs the default configuration of `cargo-make` crate using the command `cargo make`. Run this code using

   ```bash
   cargo make
   ```

2. `[tasks.build]` - runs the default `cargo build` workflow but for WebAssembly `wasm32-unknown-unknown` target. It uses `wasm-pack` to achieve this. This section will install `wasm-pack` if its not installed or the latest version is not installed, it will then create a `dev` build of the wasm package and place it in the `resources/pkg` folder. It also watches for changes in the current directory respecting the `.gitignore` file.

   ```bash
   cargo make build
   ```

3. `[tasks.build_fmt]` - does the same thing as the previous tasks (number 2), but add default rust formatting of the code with `cargo fmt` before building the code

   ```bash
   cargo make build_fmt
   ```

   

4. `[tasks.serve]` - serves the files in the `resources` folder by creating a HTTP server for front-end development. The server is accessed locally at `localhost:5500`/`127.0.0.1:5500` or on any network that the current devices is connected to at  `IP_ADDRESS:5500`

   ```bash
   cargo make serve
   ```

5. `[tasks.check]`- is useful when you add a new crate(s) to the `Cargo.toml` file. It fetches the new crates according to the `Cargo.lock` file, runs them and checks whether their licenses are approved

   ```bash
   cargo make check
   ```

6. `[tasks.fetch]` - runs a simple `cargo check` command

   ```bash
   cargo make fetch
   ```

7. `[tasks.format]` - formats the code according to default `cargo-fmt` settings or according to the rules specified in the `rustfmt.toml` file if it exists

   ```bash
   cargo make fetch
   ```

   #### NOTES:

   * Install `wasm32-unknown-unknown` target build
   * Install `wasm-pack` crate

This template is licensed under MIT license. Happy hacking!